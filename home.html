<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>دفتر الديون</title>
<link rel="stylesheet" href="style.css">
</head>

<body>

<div class="container">
<h2>دفتر الديون</h2>

<div>
<input id="dName" placeholder="الاسم">
<select id="dType">
    <option value="مدين">مدين</option>
    <option value="مدان">مدان</option>
</select>
<input id="dAmount" type="number" placeholder="المبلغ">
<button onclick="addDebt()">إضافة</button>
</div>

<table>
<thead>
<tr>
<th>الاسم</th>
<th>النوع</th>
<th>المبلغ</th>
<th>التاريخ</th>
<th>إدارة</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>

<div class="totalBox">المجموع الكلي: <span id="total">0</span> دينار</div>

<button onclick="logout()" style="background:red;margin-top:15px;">خروج</button>

</div>

<script>
let loginUser = JSON.parse(localStorage.getItem("loginUser"));
if(!loginUser) window.location.href="index.html";

// رقم المستخدم الذي يتم عرض ديونه
let userPhone = loginUser.role==="admin"
    ? localStorage.getItem("editUserPhone")
    : loginUser.phone;

if(!userPhone) userPhone = loginUser.phone;

let allDebts = JSON.parse(localStorage.getItem("debts") || "{}");

if(!allDebts[userPhone]) allDebts[userPhone] = [];

function save(){
    localStorage.setItem("debts", JSON.stringify(allDebts));
}

function render(){
    let debts = allDebts[userPhone];
    list.innerHTML = "";
    let sum = 0;

    debts.forEach((d,i)=>{
        sum += Number(d.amount);
        list.innerHTML += `
        <tr>
            <td>${d.name}</td>
            <td>${d.type}</td>
            <td>${d.amount}</td>
            <td>${d.date}</td>
            <td>
                <button onclick="pay(${i})">تسديد</button>
                <button onclick="addMore(${i})" style="background:orange;">إضافة مبلغ</button>
            </td>
        </tr>
        `;
    });

    total.innerText = sum;
}

function addDebt(){
    if(dName.value=="" || dAmount.value=="") return;

    allDebts[userPhone].push({
        name:dName.value,
        type:dType.value,
        amount:dAmount.value,
        date:new Date().toLocaleDateString()
    });

    save();
    render();

    dName.value="";
    dAmount.value="";
}

function pay(i){
    allDebts[userPhone].splice(i,1);
    save();
    render();
}

function addMore(i){
    let d = allDebts[userPhone][i];
    let more = prompt("المبلغ المضاف:");
    if(more){
        d.amount = Number(d.amount) + Number(more);
        save();
        render();
    }
}

function logout(){
    localStorage.removeItem("loginUser");
    window.location.href="index.html";
}

render();
</script>

</body>
</html>